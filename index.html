<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•¸æ“šçµ±è¨ˆåˆ†æç³»çµ±</title>
    <!-- å¼•å…¥ Excel è™•ç†å‡½å¼åº« (SheetJS) -->
    <script src="cdnjs.cloudflare.com"></script>
    <style>
        :root { font-size: calc(14px + 0.5vw); }
        body { font-family: "Microsoft JhengHei", sans-serif; background: #f0f4f8; padding: 20px; color: #333; }
        .card { max-width: 850px; margin: auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        h2 { text-align: center; color: #1a73e8; font-size: 1.8rem; }
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        @media (max-width: 600px) { .form-grid { grid-template-columns: 1fr; } }
        .field { margin-bottom: 15px; }
        label { display: block; font-weight: bold; margin-bottom: 5px; }
        input, select { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 6px; box-sizing: border-box; font-size: 1rem; }
        input[readonly] { background: #e9ecef; }
        .radio-group { display: flex; flex-wrap: wrap; gap: 10px; padding: 10px; border: 1px solid #ddd; border-radius: 6px; background: #fafafa; }
        .radio-item { display: flex; align-items: center; cursor: pointer; }
        .radio-item input { width: auto; margin-right: 5px; }
        .sub-menu { display: none; margin-top: 10px; padding: 10px; background: #fff3cd; border-radius: 6px; }
        .btns { margin-top: 25px; display: flex; gap: 10px; }
        button { flex: 1; padding: 15px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; transition: 0.3s; font-size: 1.1rem; }
        .btn-save { background: #28a745; color: white; }
        .btn-excel { background: #007bff; color: white; }
        button:hover { opacity: 0.8; }
    </style>
</head>
<body>

<div class="card">
    <h2>ğŸ“Š æ•¸æ“šçµ±è¨ˆèˆ‡åˆ†æç³»çµ±</h2>
    <form id="dataForm">
        <div class="form-grid">
            <div class="field"><label>é …æ¬¡</label><input type="text" id="seq" value="1" readonly></div>
            <div class="field"><label>åŸ·è¡Œç‹€æ³</label><input type="text" id="status" value="å·²åŸ·è¡Œ" readonly></div>
            <div class="field"><label>æ—¥æœŸæ™‚é–“</label><input type="text" id="datetime" readonly></div>
            <div class="field"><label>å§“å</label><input type="text" id="name" placeholder="è«‹è¼¸å…¥å§“å" required></div>
            <div class="field">
                <label>äººæ¬¡ (æ€§åˆ¥)</label>
                <select id="gender">
                    <option value="ç”·ç”Ÿ">ç”·ç”Ÿ</option>
                    <option value="å¥³ç”Ÿ">å¥³ç”Ÿ</option>
                    <option value="äºŒæ¬¡å…ƒ">äºŒæ¬¡å…ƒ</option>
                </select>
            </div>
        </div>

        <div class="field">
            <label>ä¸åˆ©è™•å¢ƒè€…åˆ†é¡ (é»é¸å¾Œæœƒå‡ºç¾ç´°åˆ†é¸é …)</label>
            <div class="radio-group">
                <label class="radio-item"><input type="radio" name="idType" value="ç„¡" checked onclick="toggleSub(false)"> ä¸€èˆ¬æ°‘çœ¾</label>
                <label class="radio-item"><input type="radio" name="idType" value="èº«éšœè€…" onclick="toggleSub(true)"> èº«éšœè€…</label>
                <label class="radio-item"><input type="radio" name="idType" value="åŸä½æ°‘" onclick="toggleSub(true)"> åŸä½æ°‘</label>
                <label class="radio-item"><input type="radio" name="idType" value="æ–°ä½æ°‘" onclick="toggleSub(true)"> æ–°ä½æ°‘</label>
                <label class="radio-item"><input type="radio" name="idType" value="å…¶ä»–" onclick="toggleSub(true)"> å…¶ä»–</label>
            </div>
            <div id="subGenderBox" class="sub-menu">
                <label>èº«åˆ†ç´°åˆ†æ€§åˆ¥ï¼š</label>
                <select id="subGender">
                    <option value="ç”·æ€§">ç”·æ€§</option>
                    <option value="å¥³æ€§">å¥³æ€§</option>
                </select>
            </div>
        </div>

        <div class="form-grid">
            <div class="field">
                <label>å±…ä½ç¸£å¸‚</label>
                <select id="city">
                    <option>å°ä¸­å¸‚</option><option>å½°åŒ–ç¸£</option><option>å—æŠ•ç¸£</option>
                    <option>é›²æ—ç¸£</option><option>å˜‰ç¾©ç¸£</option><option>å˜‰ç¾©å¸‚</option><option>é‡‘é–€ç¸£</option>
                </select>
            </div>
            <div class="field">
                <label>å¹´é½¡</label>
                <select id="age">
                    <option>0~19</option><option>20~29</option><option>30~39</option>
                    <option>40~49</option><option>50~59</option><option>60ä»¥ä¸Š</option>
                </select>
            </div>
        </div>

        <div class="field">
            <label>å­¸æ­·</label>
            <select id="edu">
                <option>åœ‹ä¸­ä»¥ä¸‹</option><option>é«˜ä¸­è·</option><option>å‰¯å­¸å£«</option>
                <option>å­¸å£«</option><option>ç¢©å£«</option><option>åšå£«</option>
            </select>
        </div>

        <div class="btns">
            <button type="button" class="btn-save" onclick="submitSingle()">æäº¤å–®ç­†è³‡æ–™</button>
            <button type="button" class="btn-excel" onclick="exportExcel()">å½™æ•´ä¸¦åŒ¯å‡º Excel</button>
        </div>
    </form>
</div>

<script>
    let localDB = []; 

    function updateTime() {
        const now = new Date();
        document.getElementById('datetime').value = now.toLocaleString('zh-TW');
    }
    setInterval(updateTime, 1000);
    updateTime();

    function toggleSub(show) {
        document.getElementById('subGenderBox').style.display = show ? 'block' : 'none';
    }

    async function submitSingle() {
        const idType = document.querySelector('input[name="idType"]:checked').value;
        const entry = {
            "é …æ¬¡": localDB.length + 1,
            "åŸ·è¡Œç‹€æ³": "å·²åŸ·è¡Œ",
            "æ—¥æœŸæ™‚é–“": document.getElementById('datetime').value,
            "æœƒè­°é¡åˆ¥": "", // åœ¨ Excel ä¸­ä¿ç•™ç©ºç™½æ¬„ä½ä¾›è‡ªè¡Œå¡«å¯«
            "å§“å": document.getElementById('name').value,
            "äººæ¬¡(æ€§åˆ¥)": document.getElementById('gender').value,
            "ä¸åˆ©è™•å¢ƒè€…åˆ†é¡": idType,
            "åˆ†é¡ç´°åˆ†æ€§åˆ¥": idType !== "ç„¡" ? document.getElementById('subGender').value : "N/A",
            "å±…ä½ç¸£å¸‚": document.getElementById('city').value,
            "å¹´é½¡": document.getElementById('age').value,
            "å­¸æ­·": document.getElementById('edu').value
        };

        if(!entry.å§“å) return alert("è«‹å¡«å¯«å§“åï¼");

        localDB.push(entry);

        // å­˜å…¥ Google Sheets
        const gas_url = "https://script.google.com/macros/s/AKfycbxEo19UO3y2lHG8FMEiKWcmCJXGYu4IhXfWjFGS-hRTeTDtIQ75J9hI0dEu9feKRw/exec";
        try {
            fetch(gas_url, { method: 'POST', mode: 'no-cors', body: JSON.stringify(entry)});
            alert(`ç¬¬ ${entry.é …æ¬¡} ç­†è³‡æ–™æäº¤æˆåŠŸï¼`);
        } catch(e) { console.log(e); }

        document.getElementById('name').value = "";
        document.getElementById('seq').value = localDB.length + 1;
    }

    function exportExcel() {
        if(localDB.length === 0) return alert("å°šç„¡è³‡æ–™å¯åŒ¯å‡ºï¼");
        const ws = XLSX.utils.json_to_sheet(localDB);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, "çµ±è¨ˆæ•¸æ“š");
        XLSX.writeFile(wb, "æ•¸æ“šå½™æ•´ç¸½è¡¨.xlsx");
    }
</script>

</body>
</html>
