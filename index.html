<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•¸æ“šçµ±è¨ˆåˆ†æç³»çµ±</title>
    <!-- å¼•å…¥ SheetJS è™•ç† Excel åŒ¯å‡º -->
    <script src="cdnjs.cloudflare.com"></script>
    <style>
        /* éŸ¿æ‡‰å¼å­—é«”ï¼šä¾è£ç½®è¢å¹•ç¸®æ”¾ */
        :root { font-size: calc(14px + 0.5vw); }
        body { font-family: "Microsoft JhengHei", sans-serif; background: #f4f7f6; padding: 20px; color: #333; }
        .card { max-width: 900px; margin: auto; background: #fff; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h2 { text-align: center; color: #1a73e8; margin-bottom: 20px; }
        
        /* ä½ˆå±€è¨­è¨ˆ */
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        @media (max-width: 600px) { .form-grid { grid-template-columns: 1fr; } }
        
        .field { margin-bottom: 15px; }
        label { display: block; font-weight: bold; margin-bottom: 5px; color: #555; }
        input, select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; font-size: 1rem; }
        input[readonly] { background: #eee; cursor: not-allowed; }

        /* èº«ä»½åˆ¥é»é¸å€ */
        .radio-group { display: flex; flex-wrap: wrap; gap: 10px; padding: 10px; border: 1px solid #ddd; border-radius: 6px; background: #fafafa; }
        .radio-item { display: flex; align-items: center; cursor: pointer; font-size: 0.95rem; }
        .radio-item input { width: auto; margin-right: 5px; }

        .sub-menu { display: none; margin-top: 10px; padding: 12px; background: #e3f2fd; border-radius: 6px; border-left: 5px solid #2196f3; }

        /* æŒ‰éˆ•è¨­è¨ˆ */
        .btns { margin-top: 25px; display: flex; gap: 10px; }
        button { flex: 1; padding: 15px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; transition: 0.3s; font-size: 1.1rem; }
        .btn-submit { background: #28a745; color: white; }
        .btn-excel { background: #007bff; color: white; }
        button:hover { opacity: 0.8; transform: translateY(-1px); }
    </style>
</head>
<body>

<div class="card">
    <h2>ğŸ“Š æ•¸æ“šçµ±è¨ˆç™»éŒ„ç³»çµ±</h2>
    <form id="dataForm">
        <div class="form-grid">
            <div class="field"><label>é …æ¬¡</label><input type="text" id="seq" value="1" readonly></div>
            <div class="field"><label>åŸ·è¡Œç‹€æ³</label><input type="text" id="status" value="å·²åŸ·è¡Œ" readonly></div>
            <div class="field"><label>æ—¥æœŸæ™‚é–“</label><input type="text" id="datetime" readonly></div>
            <div class="field"><label>å§“å</label><input type="text" id="name" placeholder="ç°¡æ˜“å¡«å¯«å§“å" required></div>
            <div class="field">
                <label>æ€§åˆ¥ (äººæ¬¡é¸é …)</label>
                <select id="gender">
                    <option value="ç”·ç”Ÿ">ç”·ç”Ÿ</option>
                    <option value="å¥³ç”Ÿ">å¥³ç”Ÿ</option>
                    <option value="äºŒæ¬¡å…ƒ">äºŒæ¬¡å…ƒ</option>
                </select>
            </div>
            <div class="field">
                <label>æœƒè­°é¡åˆ¥</label>
                <input type="text" id="meeting" placeholder="åŒ¯å‡ºå¾Œå¯æ–¼ Excel å¡«å¯«">
            </div>
        </div>

        <div class="field">
            <label>èº«ä»½åˆ¥ (é»é¸åˆ†é¡)</label>
            <div class="radio-group">
                <label class="radio-item"><input type="radio" name="idType" value="ç„¡" checked onclick="toggleSub(false)"> ä¸€èˆ¬æ°‘çœ¾</label>
                <label class="radio-item"><input type="radio" name="idType" value="èº«éšœè€…" onclick="toggleSub(true)"> èº«éšœè€…</label>
                <label class="radio-item"><input type="radio" name="idType" value="åŸä½æ°‘" onclick="toggleSub(true)"> åŸä½æ°‘</label>
                <label class="radio-item"><input type="radio" name="idType" value="æ–°ä½æ°‘" onclick="toggleSub(true)"> æ–°ä½æ°‘</label>
                <label class="radio-item"><input type="radio" name="idType" value="å…¶ä»–" onclick="toggleSub(true)"> å…¶ä»–</label>
            </div>
            <div id="subGenderBox" class="sub-menu">
                <label>ä¸åˆ©è™•å¢ƒè€…ç´°åˆ†æ€§åˆ¥ï¼š</label>
                <select id="subGender">
                    <option value="ç”·æ€§">ç”·æ€§</option>
                    <option value="å¥³æ€§">å¥³æ€§</option>
                </select>
            </div>
        </div>

        <div class="form-grid">
            <div class="field">
                <label>å±…ä½ç¸£å¸‚</label>
                <select id="city">
                    <option>å°ä¸­å¸‚</option><option>å½°åŒ–ç¸£</option><option>å—æŠ•ç¸£</option>
                    <option>é›²æ—ç¸£</option><option>å˜‰ç¾©ç¸£</option><option>å˜‰ç¾©å¸‚</option><option>é‡‘é–€ç¸£</option>
                </select>
            </div>
            <div class="field">
                <label>å¹´é½¡</label>
                <select id="age">
                    <option>0~19</option><option>20~29</option><option>30~39</option>
                    <option>40~49</option><option>50~59</option><option>60ä»¥ä¸Š</option>
                </select>
            </div>
            <div class="field">
                <label>å­¸æ­·</label>
                <select id="edu">
                    <option>åœ‹ä¸­ä»¥ä¸‹</option><option>é«˜ä¸­è·</option><option>å‰¯å­¸å£«</option>
                    <option>å­¸å£«</option><option>ç¢©å£«</option><option>åšå£«</option>
                </select>
            </div>
        </div>

        <div class="btns">
            <button type="button" class="btn-submit" onclick="submitData()">æäº¤å–®ç­†è³‡æ–™</button>
            <button type="button" class="btn-excel" onclick="exportExcel()">å½™æ•´å°å‡º Excel</button>
        </div>
    </form>
</div>

<script>
    let localData = []; 

    // è‡ªå‹•æ›´æ–°æ—¥æœŸæ™‚é–“
    function updateClock() {
        const now = new Date();
        document.getElementById('datetime').value = now.toLocaleString('zh-TW');
    }
    setInterval(updateClock, 1000);
    updateClock();

    // èº«ä»½é¸å–®åˆ‡æ›
    function toggleSub(show) {
        document.getElementById('subGenderBox').style.display = show ? 'block' : 'none';
    }

    // æäº¤å–®ç­†è³‡æ–™
    async function submitData() {
        const nameVal = document.getElementById('name').value;
        if (!nameVal) return alert("è«‹å¡«å¯«å§“å");

        const idType = document.querySelector('input[name="idType"]:checked').value;
        const entry = {
            "é …æ¬¡": localData.length + 1,
            "åŸ·è¡Œç‹€æ³": "å·²åŸ·è¡Œ",
            "æ—¥æœŸæ™‚é–“": document.getElementById('datetime').value,
            "æœƒè­°é¡åˆ¥": document.getElementById('meeting').value,
            "å§“å": nameVal,
            "äººæ¬¡(æ€§åˆ¥)": document.getElementById('gender').value,
            "èº«ä»½åˆ¥": idType,
            "èº«ä»½ç´°åˆ†æ€§åˆ¥": idType !== "ç„¡" ? document.getElementById('subGender').value : "N/A",
            "å±…ä½ç¸£å¸‚": document.getElementById('city').value,
            "å¹´é½¡": document.getElementById('age').value,
            "å­¸æ­·": document.getElementById('edu').value
        };

        localData.push(entry);

        // ä¸²æ¥ Google Sheets (è«‹æ›¿æ›ç‚ºæ‚¨çš„ Apps Script URL)
        const scriptURL = 'https://script.google.com/macros/s/AKfycbxEo19UO3y2lHG8FMEiKWcmCJXGYu4IhXfWjFGS-hRTeTDtIQ75J9hI0dEu9feKRw/exec';
        try {
            fetch(scriptURL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(entry) });
            alert(`ç¬¬ ${entry.é …æ¬¡} ç­†è³‡æ–™å·²æš«å­˜ä¸¦æäº¤ï¼`);
        } catch (e) {
            console.error('å„²å­˜å¤±æ•—', e);
        }

        // æ¸…ç†ä¸¦æ›´æ–°é …æ¬¡
        document.getElementById('name').value = "";
        document.getElementById('seq').value = localData.length + 1;
    }

    // å½™æ•´ä¸¦ä¸‹è¼‰ Excel
    function exportExcel() {
        if (localData.length === 0) return alert("å°šç„¡è³‡æ–™å¯å°å‡º");
        const ws = XLSX.utils.json_to_sheet(localData);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, "çµ±è¨ˆç¸½è¡¨");
        // ä¸‹è¼‰æª”æ¡ˆè‡³æ¡Œé¢(ä¸‹è¼‰è³‡æ–™å¤¾)
        XLSX.writeFile(wb, `æ•¸æ“šå½™æ•´è¡¨_${new Date().getTime()}.xlsx`);
    }
</script>
</body>
</html>
