<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•¸æ“šçµ±è¨ˆåˆ†æç³»çµ±</title>
    <!-- å¼•å…¥ SheetJS è™•ç† Excel åŒ¯å‡º -->
    <script src="cdnjs.cloudflare.com"></script>
    <style>
        :root { font-size: calc(14px + 0.5vw); }
        body { font-family: "Microsoft JhengHei", sans-serif; background: #f4f7f6; padding: 20px; color: #333; }
        .card { max-width: 900px; margin: auto; background: #fff; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h2 { text-align: center; color: #1a73e8; margin-bottom: 20px; }
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        @media (max-width: 600px) { .form-grid { grid-template-columns: 1fr; } }
        .field { margin-bottom: 15px; }
        label { display: block; font-weight: bold; margin-bottom: 5px; color: #555; }
        input, select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; font-size: 1rem; }
        input[readonly] { background: #eee; cursor: not-allowed; }
        .radio-group { display: flex; flex-wrap: wrap; gap: 10px; padding: 10px; border: 1px solid #ddd; border-radius: 6px; background: #fafafa; }
        .radio-item { display: flex; align-items: center; cursor: pointer; font-size: 0.95rem; }
        .radio-item input { width: auto; margin-right: 5px; }
        .sub-menu { display: none; margin-top: 10px; padding: 12px; background: #e3f2fd; border-radius: 6px; border-left: 5px solid #2196f3; }
        .btns { margin-top: 25px; display: flex; gap: 10px; }
        button { flex: 1; padding: 15px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; transition: 0.3s; font-size: 1.1rem; }
        .btn-submit { background: #28a745; color: white; }
        .btn-excel { background: #007bff; color: white; }
        button:hover { opacity: 0.8; transform: translateY(-1px); }
        .error-focus { border: 2px solid #dc3545 !important; background-color: #fff8f8; }
    </style>
</head>
<body>

<div class="card">
    <h2>ğŸ“Š æ•¸æ“šçµ±è¨ˆç™»éŒ„ç³»çµ±</h2>
    <form id="dataForm">
        <div class="form-grid">
            <div class="field"><label>åŸ·è¡Œç‹€æ³</label><input type="text" id="status" value="å·²åŸ·è¡Œ" readonly></div>
            <div class="field"><label>æ—¥æœŸæ™‚é–“</label><input type="text" id="datetime" readonly></div>
            <div class="field"><label>æœƒè­°é¡åˆ¥</label><input type="text" id="meeting" placeholder="è«‹è¼¸å…¥æ´»å‹•åç¨±" required></div>
            <div class="field"><label>å§“å</label><input type="text" id="name" placeholder="è«‹å¡«å¯«å§“å" required></div>
            <div class="field">
                <label>æ€§åˆ¥ (äººæ¬¡é¸é …)</label>
                <select id="gender">
                    <option value="ç”·ç”Ÿ">ç”·ç”Ÿ</option>
                    <option value="å¥³ç”Ÿ">å¥³ç”Ÿ</option>
                    <option value="äºŒæ¬¡å…ƒ">äºŒæ¬¡å…ƒ</option>
                </select>
            </div>
        </div>

        <div class="field">
            <label>èº«ä»½åˆ¥ (ä¸åˆ©è™•å¢ƒè€…åˆ†é¡)</label>
            <div class="radio-group">
                <label class="radio-item"><input type="radio" name="idType" value="ç„¡" checked onclick="toggleSub(false)"> ä¸€èˆ¬æ°‘çœ¾</label>
                <label class="radio-item"><input type="radio" name="idType" value="èº«éšœè€…" onclick="toggleSub(true)"> èº«éšœè€…</label>
                <label class="radio-item"><input type="radio" name="idType" value="åŸä½æ°‘" onclick="toggleSub(true)"> åŸä½æ°‘</label>
                <label class="radio-item"><input type="radio" name="idType" value="æ–°ä½æ°‘" onclick="toggleSub(true)"> æ–°ä½æ°‘</label>
                <label class="radio-item"><input type="radio" name="idType" value="å…¶ä»–" onclick="toggleSub(true)"> å…¶ä»–</label>
            </div>
            <div id="subGenderBox" class="sub-menu">
                <label>ä¸åˆ©è™•å¢ƒè€…æ€§åˆ¥ï¼š</label>
                <select id="subGender">
                    <option value="ç”·æ€§">ç”·æ€§</option>
                    <option value="å¥³æ€§">å¥³æ€§</option>
                </select>
            </div>
        </div>

        <div class="form-grid">
            <div class="field">
                <label>å±…ä½ç¸£å¸‚</label>
                <select id="city">
                    <option>å°ä¸­å¸‚</option><option>å½°åŒ–ç¸£</option><option>å—æŠ•ç¸£</option>
                    <option>é›²æ—ç¸£</option><option>å˜‰ç¾©ç¸£</option><option>å˜‰ç¾©å¸‚</option><option>é‡‘é–€ç¸£</option>
                </select>
            </div>
            <div class="field">
                <label>å¹´é½¡</label>
                <select id="age">
                    <option>0~19</option><option>20~29</option><option>30~39</option>
                    <option>40~49</option><option>50~59</option><option>60ä»¥ä¸Š</option>
                </select>
            </div>
            <div class="field">
                <label>å­¸æ­·</label>
                <select id="edu">
                    <option>åœ‹ä¸­ä»¥ä¸‹</option><option>é«˜ä¸­è·</option><option>å‰¯å­¸å£«</option>
                    <option>å­¸å£«</option><option>ç¢©å£«</option><option>åšå£«</option>
                </select>
            </div>
        </div>

        <div class="btns">
            <button type="button" class="btn-submit" onclick="submitData()">æäº¤è³‡æ–™ä¸¦æª¢æŸ¥ä¸‹ä¸€å ´</button>
            <button type="button" class="btn-excel" onclick="exportExcel()">å½™æ•´å°å‡º Excel</button>
        </div>
    </form>
</div>

<script>
    let localData = []; 

    function updateClock() {
        const now = new Date();
        document.getElementById('datetime').value = now.toLocaleString('zh-TW');
    }
    setInterval(updateClock, 1000);
    updateClock();

    function toggleSub(show) {
        document.getElementById('subGenderBox').style.display = show ? 'block' : 'none';
    }

    async function submitData() {
        const nameEl = document.getElementById('name');
        const meetingEl = document.getElementById('meeting');
        const genderEl = document.getElementById('gender');
        const subGenderEl = document.getElementById('subGender');

        nameEl.classList.remove('error-focus');
        meetingEl.classList.remove('error-focus');

        if (!meetingEl.value) {
            alert("è«‹å¡«å¯«ã€Œæœƒè­°é¡åˆ¥ã€ï¼");
            meetingEl.classList.add('error-focus');
            meetingEl.focus();
            return;
        }
        if (!nameEl.value) {
            alert("è«‹å¡«å¯«ã€Œå§“åã€ï¼");
            nameEl.classList.add('error-focus');
            nameEl.focus();
            return;
        }

        const idTypeSelected = document.querySelector('input[name="idType"]:checked').value;
        
        // ä¿®æ­£ï¼šä»£å…¥äººæ¬¡æ€§åˆ¥èˆ‡èº«ä»½ç´°åˆ†æ€§åˆ¥
        const entry = {
            "åŸ·è¡Œç‹€æ³": document.getElementById('status').value,
            "æ—¥æœŸæ™‚é–“": document.getElementById('datetime').value,
            "æœƒè­°é¡åˆ¥": meetingEl.value,
            "å§“å": nameEl.value,
            "äººæ¬¡(æ€§åˆ¥)": genderEl.options[genderEl.selectedIndex].value,
            "èº«ä»½åˆ¥": idTypeSelected,
            "èº«ä»½ç´°åˆ†æ€§åˆ¥": idTypeSelected !== "ç„¡" ? subGenderEl.options[subGenderEl.selectedIndex].value : "N/A",
            "å±…ä½ç¸£å¸‚": document.getElementById('city').value,
            "å¹´é½¡": document.getElementById('age').value,
            "å­¸æ­·": document.getElementById('edu').value
        };

        localData.push(entry);

        const scriptURL = 'https://script.google.com/macros/s/AKfycbxEo19UO3y2lHG8FMEiKWcmCJXGYu4IhXfWjFGS-hRTeTDtIQ75J9hI0dEu9feKRw/exec';
        try {
            fetch(scriptURL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(entry) });
            alert(`è³‡æ–™æäº¤æˆåŠŸï¼`);
        } catch (e) {
            console.error('é›²ç«¯å„²å­˜å¤±æ•—', e);
        }

        nameEl.value = "";

        setTimeout(() => {
            const isFinished = confirm("è©²å ´æ´»å‹•æ˜¯å¦å·²çµæŸï¼Ÿ\n(ç¢ºå®šï¼šè¼¸å…¥æ–°æ´»å‹•é¡åˆ¥ï¼›å–æ¶ˆï¼šæ²¿ç”¨ç•¶å‰é¡åˆ¥)");
            if (isFinished) {
                const newMeeting = prompt("è«‹è¼¸å…¥ä¸‹ä¸€å ´æ´»å‹•çš„ã€Œæœƒè­°é¡åˆ¥ã€ï¼š", meetingEl.value);
                if (newMeeting !== null && newMeeting !== "") {
                    meetingEl.value = newMeeting;
                }
            }
        }, 300);
    }

    function exportExcel() {
        if (localData.length === 0) return alert("å°šç„¡è³‡æ–™å¯å°å‡º");
        const ws = XLSX.utils.json_to_sheet(localData);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, "çµ±è¨ˆç¸½è¡¨");
        XLSX.writeFile(wb, `æ•¸æ“šå½™æ•´è¡¨_${new Date().getTime()}.xlsx`);
    }
</script>
</body>
</html>
