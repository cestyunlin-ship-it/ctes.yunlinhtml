<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>數據統計分析系統</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="cdnjs.cloudflare.com"></script>
    <style>
        /* 依螢幕縮放字體：手機小、電腦大 */
        html { font-size: calc(14px + 0.5vw); }
        .error-border { border: 2px solid #ef4444 !important; }
    </style>
</head>
<body class="bg-gray-100 p-4 md:p-10">
    <div class="max-w-4xl mx-auto bg-white p-8 rounded-lg shadow-lg">
        <h1 class="text-2xl font-bold mb-6 text-center text-blue-600">會議數據統計系統</h1>
        
        <form id="dataForm" class="space-y-4">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- 自動帶入欄位 -->
                <div>
                    <label class="block font-semibold">執行狀況</label>
                    <input type="text" id="status" value="已執行" readonly class="w-full p-2 bg-gray-200 rounded">
                </div>
                <div>
                    <label class="block font-semibold">日期時間</label>
                    <input type="text" id="timestamp" readonly class="w-full p-2 bg-gray-200 rounded">
                </div>

                <!-- 智慧功能：自動更換類別 -->
                <div>
                    <label class="block font-semibold">會議類別</label>
                    <select id="meetingType" required class="w-full p-2 border rounded">
                        <option value="常規會議">常規會議</option>
                        <option value="專案報告">專案報告</option>
                        <option value="緊急討論">緊急討論</option>
                    </select>
                </div>

                <div>
                    <label class="block font-semibold">姓名</label>
                    <input type="text" id="name" required placeholder="請輸入姓名" class="w-full p-2 border rounded">
                </div>

                <div>
                    <label class="block font-semibold">性別</label>
                    <select id="gender" required class="w-full p-2 border rounded">
                        <option value="">請選擇</option>
                        <option value="男生">男生</option>
                        <option value="女生">女生</option>
                        <option value="二次元">二次元</option>
                    </select>
                </div>

                <!-- 身份別與次級選單 -->
                <div>
                    <label class="block font-semibold">身份別</label>
                    <div class="flex flex-wrap gap-2 mt-1">
                        <label> 身障者</label>
                        <label> 原住民</label>
                        <label> 新住民</label>
                        <label> 其他</label>
                    </div>
                    <select id="subGender" class="w-full mt-2 p-2 border rounded bg-blue-50">
                        <option value="">請先選擇身份 (選填性別)</option>
                        <option value="男性">男性</option>
                        <option value="女性">女性</option>
                    </select>
                </div>

                <div>
                    <label class="block font-semibold">居住縣市</label>
                    <select id="city" required class="w-full p-2 border rounded">
                        <option value="">請選擇</option>
                        <option value="台中市">台中市</option>
                        <option value="彰化縣">彰化縣</option>
                        <option value="南投縣">南投縣</option>
                        <option value="雲林縣">雲林縣</option>
                        <option value="嘉義縣">嘉義縣</option>
                        <option value="嘉義市">嘉義市</option>
                        <option value="金門縣">金門縣</option>
                    </select>
                </div>

                <div>
                    <label class="block font-semibold">年齡</label>
                    <select id="age" required class="w-full p-2 border rounded">
                        <option value="">請選擇</option>
                        <option value="0~19">0~19</option>
                        <option value="20~29">20~29</option>
                        <option value="30~39">30~39</option>
                        <option value="40~49">40~49</option>
                        <option value="50~59">50~59</option>
                        <option value="60以上">60以上</option>
                    </select>
                </div>

                <div>
                    <label class="block font-semibold">學歷</label>
                    <select id="education" required class="w-full p-2 border rounded">
                        <option value="">請選擇</option>
                        <option value="國中以下">國中以下</option>
                        <option value="高中職">高中職</option>
                        <option value="副學士">副學士</option>
                        <option value="學士">學士</option>
                        <option value="碩士">碩士</option>
                        <option value="博士">博士</option>
                    </select>
                </div>
            </div>

            <div class="mt-6 flex gap-4">
                <button type="button" onclick="handleSubmit()" class="flex-1 bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 transition">提交並存入資料庫</button>
                <button type="button" onclick="exportToExcel()" class="flex-1 bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition">彙整並下載 Excel</button>
            </div>
        </form>
    </div>

    <script>
        // 初始化時間
        document.getElementById('timestamp').value = new Date().toLocaleString();

        let allData = JSON.parse(localStorage.getItem('meetingDB')) || [];

        // 提交處理
        function handleSubmit() {
            const form = document.getElementById('dataForm');
            const inputs = form.querySelectorAll('input[required], select[required]');
            let firstError = null;

            // 驗證與跳轉錯誤
            inputs.forEach(input => {
                if (!input.value || (input.type === 'radio' && !form.identity.value)) {
                    input.classList.add('error-border');
                    if (!firstError) firstError = input;
                } else {
                    input.classList.remove('error-border');
                }
            });

            if (firstError) {
                firstError.focus();
                alert('請填寫完整資訊！');
                return;
            }

            // 蒐集資料
            const entry = {
                執行狀況: "已執行",
                日期時間: new Date().toLocaleString(),
                會議類別: document.getElementById('meetingType').value,
                姓名: document.getElementById('name').value,
                性別: document.getElementById('gender').value,
                身份別: form.querySelector('input[name="identity"]:checked').value,
                身份性別: document.getElementById('subGender').value,
                居住縣市: document.getElementById('city').value,
                年齡: document.getElementById('age').value,
                學歷: document.getElementById('education').value
            };

            // 儲存至資料庫 (此處以 localStorage 模擬單筆儲存，建議串接 Google Apps Script API)
            allData.push(entry);
            localStorage.setItem('meetingDB', JSON.stringify(allData));
            
            alert('提交成功！資料已存入雲端模擬庫。');
            form.reset();
            document.getElementById('timestamp').value = new Date().toLocaleString();
            smartUpdateMeeting(); // 執行智慧更新
        }

        // 智慧更換會議類別邏輯
        function smartUpdateMeeting() {
            const types = ["常規會議", "專案報告", "緊急討論"];
            const current = document.getElementById('meetingType').value;
            const nextIndex = (types.indexOf(current) + 1) % types.length;
            document.getElementById('meetingType').value = types[nextIndex];
        }

        // 下載 Excel (自動彙整多筆為單一檔案)
        function exportToExcel() {
            if (allData.length === 0) return alert("尚無資料可匯出");
            
            const ws = XLSX.utils.json_to_sheet(allData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "會議數據");
            
            // 下載檔案
            XLSX.writeFile(wb, `會議數據彙整_${new Date().toLocaleDateString()}.xlsx`);
        }

        function updateSubGender() {
            // 當選擇身份時，可連動提示
            document.getElementById('subGender').classList.add('bg-yellow-50');
        }
    </script>
</body>
</html>
